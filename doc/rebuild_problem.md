# 문제점
## 어플리케이션 소스 변경으로 다시 빌드하는 것에 대한 문제점
- 소스 변경으로 인해 "모든 파일, 디렉토리"를 다시 빌드하는 것은 매우 비효율적!이다.
  - ex) 단 하나의 부분만 바뀌었는데, 바뀌지 않은 부분까지 다시 COPY하고, 빌드하는 것은 비효율적이다.
- 소스 변경으로 다시 이미지를 만들고 컨테이너를 실행시키는 것이 번거롭다.

## 해결 - 어플리케이션 소스 변경으로 재빌드시 효율적으로 하는 방법
1. 먼저 종속성 부분만 COPY를 진행한다.
2. 그리고 종속성에 대한 RUN을 수행한 후에,
3. 소스를 COPY한다.
=> 이후에 재빌드를 하더라도, 모듈(종속성)에 변화가 있을 때만 다시 다운 받으며
=> 소스 코드에만 변화가 있을 경우, 다시 다운받지 않는다.


```docker
# npm 명령어를 포함하는 베이스 이미지를 설정해야한다.
# node에는 npm이 포함되어있기에 node 이미지를 사용한다.
# 10버전을 사용한다.
FROM node:10

# WORKDIR을 지정함으로써 프로그램을 실행시키는데 필요한
# 파일, 디렉토리를 한 곳에 모아 보관한다.
WORKDIR /usr/src/app

# npm : Node.js로 만들어진 모듈을 웹에서 받아서 설치하고 관리해주는 프로그램
# npm install을 통해 package.json에 적혀있는 종속성들을 웹에서 자동으로 다운 받아서 설치할 수 있다.
# 하지만, package.json이 컨테이너에 없기에 npm install만 쓸 경우 에러가 발생한다. 
# -> COPY를 사용하여 package.json을 컨테이너 안에 넣어야한다. // COPY package.json ./
# 그러면, server.js가 같은 이유로 에러가 발생한다. 디렉토리의 모든 파일을 복사해야한다. // COPY ./ ./
################### 바뀐부분###################################
# 먼저 종속성 부분을 다운받고 RUN을 함으로써 재빌드시 효율을 높인다.
COPY package.json ./
RUN npm install

# 종속성부분을 제외한 부분을 COPY한다.
COPY ./ ./


# node server.js로 server.js를 실행시킨다.
CMD ["node", "server.js"]
```